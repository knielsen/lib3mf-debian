From 543a56e91a5c1444dbecf4d2d9d141a18fb57f1a Mon Sep 17 00:00:00 2001
From: Torsten Paul <Torsten.Paul@gmx.de>
Date: Sat, 29 Dec 2018 18:43:39 +0100
Subject: [PATCH 2/5] Use project version setting (requires cmake 3.0.2).

---
 CMakeLists.txt                        | 35 ++++++++++++++-------------
 Include/Model/COM/NMR_COMVersion.h.in |  6 ++---
 2 files changed, 21 insertions(+), 20 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4ba4a89..868e161 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,15 +1,16 @@
-cmake_minimum_required (VERSION 2.8)
+cmake_minimum_required (VERSION 3.0.2)
 
 IF (NOT ${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} LESS 3.1)
   cmake_policy(SET CMP0054 OLD)
 ENDIF ()
 
-project (lib3MF)
-
-# Define Version
-set(LIB3MF_VERSION_MAJOR 1)				# increase on every backward-compatibility breaking change of the API
-set(LIB3MF_VERSION_MINOR 8)				# increase on every backward compatible change of the API
-set(LIB3MF_VERSION_MICRO 0)				# increase on on every change that does not alter the API
+# Define Project and Version Numbers
+# increase major version on every backward-compatibility breaking change of the API
+# increase minor version on every backward compatible change of the API
+# increase patch version on every change that does not alter the API
+project (lib3MF
+	VERSION 1.8.0
+	DESCRIPTION "Lib3MF is a C++ implementation of the 3D Manufacturing Format file standard.")
 
 include(GNUInstallDirs)
 
@@ -74,13 +75,13 @@ if (WIN32)
 	   NAME "lib3MF"
 	   FILE_DESCRIPTION "Lib3MF is the reference-implementation of the 3D Manufacturing Format file standard"
 	   BUNDLE "3MF Consortium"
-	   VERSION_MAJOR ${LIB3MF_VERSION_MAJOR}
-	   VERSION_MINOR ${LIB3MF_VERSION_MINOR}
-	   VERSION_PATCH ${LIB3MF_VERSION_MICRO}
+	   VERSION_MAJOR ${PROJECT_VERSION_MAJOR}
+	   VERSION_MINOR ${PROJECT_VERSION_MINOR}
+	   VERSION_PATCH ${PROJECT_VERSION_PATCH}
 	   VERSION_REVISION ${BUILD_NUMBER}
-	   PRODUCT_VERSION_MAJOR ${LIB3MF_VERSION_MAJOR}
-	   PRODUCT_VERSION_MINOR ${LIB3MF_VERSION_MINOR}
-	   PRODUCT_VERSION_PATCH ${LIB3MF_VERSION_MICRO}
+	   LIB3MF_VERSION_MAJOR ${PROJECT_VERSION_MAJOR}
+	   LIB3MF_VERSION_MINOR ${PROJECT_VERSION_MINOR}
+	   LIB3MF_VERSION_MICRO ${PROJECT_VERSION_PATCH}
 	   COMPANY_NAME "3MF Consortium"
 	)
 	message("VERSION_FILES_OUTPUTLOCATION ... " ${VERSION_FILES_OUTPUTLOCATION})
@@ -98,8 +99,8 @@ SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES PREFIX "" IMPORT_PREFIX "")
 if (UNIX OR MINGW)
 	target_compile_options(${PROJECT_NAME}_s PUBLIC "-fPIC")
 	# Uncomment the following to but the version info into the .so-file.
-	SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES VERSION "${LIB3MF_VERSION_MAJOR}.${LIB3MF_VERSION_MINOR}.${LIB3MF_VERSION_MICRO}.${BUILD_NUMBER}")
-	SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES SOVERSION "${LIB3MF_VERSION_MAJOR}")
+	SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES VERSION "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}.${PROJECT_VERSION_PATCH}")
+	SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES SOVERSION "${PROJECT_VERSION_MAJOR}")
 	if (NOT APPLE)
 		SET_TARGET_PROPERTIES(${PROJECT_NAME}_s PROPERTIES LINK_FLAGS -s)
 	endif()
@@ -126,8 +127,8 @@ SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES PREFIX "" IMPORT_PREFIX "")
 target_link_libraries(${PROJECT_NAME} ${PROJECT_NAME}_s)
 if (UNIX OR MINGW)
 	# Uncomment the following to but the version info into the .so-file.
-	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES VERSION "${LIB3MF_VERSION_MAJOR}.${LIB3MF_VERSION_MINOR}.${LIB3MF_VERSION_MICRO}.${BUILD_NUMBER}")
-	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES SOVERSION "${LIB3MF_VERSION_MAJOR}")
+	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES VERSION "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}.${PROJECT_VERSION_PATCH}.${BUILD_NUMBER}")
+	SET_TARGET_PROPERTIES(${PROJECT_NAME} PROPERTIES SOVERSION "${PROJECT_VERSION_MAJOR}")
 endif()
 install(TARGETS ${PROJECT_NAME}
 	ARCHIVE DESTINATION "${CMAKE_INSTALL_LIBDIR}"
diff --git a/Include/Model/COM/NMR_COMVersion.h.in b/Include/Model/COM/NMR_COMVersion.h.in
index 208c085..6198c69 100644
--- a/Include/Model/COM/NMR_COMVersion.h.in
+++ b/Include/Model/COM/NMR_COMVersion.h.in
@@ -38,11 +38,11 @@ NMR_COMVersion.h defines the current implementation version.
 #define NMR_APIVERSION_MINOR 1
 
 // Interface version for the API
-#define NMR_APIVERSION_INTERFACE_MAJOR ${LIB3MF_VERSION_MAJOR}
+#define NMR_APIVERSION_INTERFACE_MAJOR ${PROJECT_VERSION_MAJOR}
 
-#define NMR_APIVERSION_INTERFACE_MINOR ${LIB3MF_VERSION_MINOR}
+#define NMR_APIVERSION_INTERFACE_MINOR ${PROJECT_VERSION_MINOR}
 
-#define NMR_APIVERSION_INTERFACE_MICRO ${LIB3MF_VERSION_MICRO}
+#define NMR_APIVERSION_INTERFACE_MICRO ${PROJECT_VERSION_PATCH}
 
 
 // Interface version for extension API
-- 
2.19.2

